process {

    // Needs the glob to force the config to be applied
    withName: ".*RSEM_PREPAREREFERENCE|.*SENTIEON_RSEMPREPAREREFERENCE" {
        ext.args = "--star "
    }

    withName: ".*RSEM_CALCULATEEXPRESSION|.*SENTIEON_RSEMCALCULATEEXPRESSION" {
        ext.args = '--star --star-gzipped-read-file'
    }

}

// NOTE This is how pipeline users will use Sentieon in real world use
if (System.getenv('SENTIEON_LICSRVR_IP')) {
    env.SENTIEON_LICENSE = "$SENTIEON_LICSRVR_IP"
}
//NOTE This should only happen in GitHub actions or nf-core MegaTests
if (System.getenv('SENTIEON_AUTH_MECH')) {
    env.SENTIEON_AUTH_MECH = "$SENTIEON_AUTH_MECH"
}
if (secrets.SENTIEON_AUTH_DATA) {
    env.SENTIEON_AUTH_DATA = secrets.SENTIEON_AUTH_DATA
}

// NOTE This is how pipeline users will test out Sentieon with a license file
// nextflow secrets set SENTIEON_LICENSE_BASE64 \$(cat <sentieon_license_file.lic> | base64 -w 0)
